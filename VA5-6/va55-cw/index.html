<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>HTML + CSS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />
  </head>
  <body class="container">
    <h1>Todo App</h1>
    <h2>Show Todos</h2>
    <button id="getTodos">get Todos</button>
      <ul id="listTodos"></ul>
      <div class="gettodoerror"></div>
    <form id="todoForm">
      <label for="title">Title</label><br>
      <input type="text" id="title"><br><br>

      <label for="completedTodo">Completed</label>
      <input type="checkbox" id="completedTodo">
      <br><br>
      <button type="submit">Add Todo</button>
    </form>
    <div id="con"></div>
    <script>
      const todoForm =document.querySelector('#todoForm')
      const title =document.querySelector('#title')
      const completedTodo =document.querySelector('#completedTodo')
      const output =document.querySelector('#con')
      const getTodos =document.querySelector('#getTodos')
      const apiUrl =`https://todos-student-neog.replit.app/todos`
      const listTodos = document.querySelector('#listTodos')
      const gettodoerror = document.querySelector('#gettodoerror')
      getTodos.addEventListener('click',function(){
        listTodos.innerHTML = ''
        fetch(apiUrl).then(function(res){
            return res.json()
        }).then(function(data){
          console.log(data)
         
        if(data){
          for(let i= 0;i<data.length;i++){
              const liElements = document.createElement('li')
              liElements.textContent =`${data[i].title} (Completed : ${data[i].completed})`
              listTodos.appendChild(liElements)
          }}else{
            gettodoerror.textContent ='fail to fetch todos'
          }
        }).catch(function(e){
          gettodoerror.textContent ='an error while getting the todos'
        })
      })


      todoForm.addEventListener('submit',function(event){
         event.preventDefault()
        const todoData = {
          title:title.value,
          completed : completedTodo.checked
        }

        fetch(apiUrl,{
          method:"POST",
          body:JSON.stringify(todoData),
          headers:{
            "content-type": "application/json"
          }
        }).then(function(res){
            return res.json()
        }).then(function(data){
          if(data){
            console.log(data)
             output.textContent=`Todo added Sussessfully`
             

            }else{
             output.textContent=`Failed to add Todo.`
             
            }
        }).catch(function(error){
             output.textContent=`An error occoured adding Todo.`

        })
      })
    </script>
  
  </body>
</html>
