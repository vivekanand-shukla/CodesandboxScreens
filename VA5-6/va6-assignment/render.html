<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Player List with Filter</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">ICC Player Management</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse px-4 justify-content-end" id="navbarText">
        <span class="navbar-text">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link active text-secondary-emphasis" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link text-secondary-emphasis" href="render.html">Players List</a></li>
            <li class="nav-item"><a class="nav-link text-secondary-emphasis" href="Add.html">Add Players</a></li>
          </ul>
        </span>
      </div>
    </div>
  </nav>

  <main class="container mt-4">
    <h2>Player List</h2>
    <div class="mb-3">
      <label for="roleFilter">Filter by Playing Role:</label>
      <select id="roleFilter" class="form-select" style="max-width: 300px;">
      
        <option value="all">All</option>
        <option value="Batsman">Batsman</option>
        <option value="Bowler">Bowler</option>
        <option value="All-Rounder">All-Rounder</option>
      </select>
    </div>
    <div id="playerList"></div>
  </main>

  <script>
    const apiURL = "https://players-backend-student-neog-ca.replit.app/players";
    const playerList = document.getElementById('playerList');
    const roleFilter = document.getElementById('roleFilter');
    let playersData = [];


   function ab(){  fetch(apiURL)
      .then(function(res) { return res.json()})
      .then(function (data){  
        playersData = data;
        renderPlayers(roleFilter.value) 
      })
    }
    ab()

    function renderPlayers(selectedRole) {
      playerList.innerHTML = ''; 
   let deleteButtons =null;
      for (let i = 0; i < playersData.length; i++) {
        const player = playersData[i];
     
     
       if (selectedRole === player.playingRole) {
        const playerCard = document.createElement('div');
          playerCard.className = 'card mb-2';
          playerCard.innerHTML = `
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <strong>Player - ${player.fullName} </strong> - Playing Role: ${player.playingRole} - Nationality: ${player.nationality}
              </div>
              <button class="delete btn btn-danger btn-sm" data-id='${player._id}'>Delete</button>
            </div>
          `;
          playerList.appendChild(playerCard);
          
        } else  if(selectedRole ==="all"){
          const playerCard = document.createElement('div');
          playerCard.className = 'card mb-2';
          playerCard.innerHTML = `
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <strong>Player - ${player.fullName} </strong> - Playing Role: ${player.playingRole} - Nationality: ${player.nationality}
              </div>
              <button class="delete btn btn-danger btn-sm" data-id='${player._id}'>Delete</button>
            </div>
          `;
          playerList.appendChild(playerCard);
          
        }
        
      } 
    
      deleteButtons = document.querySelectorAll('.delete');
      
      for (let i = 0; i < deleteButtons.length; i++) {
        deleteButtons[i].addEventListener('click', function(e) {
          const id = e.target.getAttribute('data-id');
          fetch(`${apiURL}/${id}`, { method: 'DELETE' })
            .then( function (res ){ return   res.json()})
            .then(function(data)  {
                if(data){
              alert('Player Deleted!');
            
             }else{
                alert('unsuccessful!')
             }


             ab()
            })
            
        });
      }
    
    }

    roleFilter.addEventListener('change', function() {
      const selectedRole = roleFilter.value;
      renderPlayers(selectedRole);
    });




  </script>
</body>
</html>
